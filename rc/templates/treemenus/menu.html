{% load tree_menu_tags %}
{% load url from future %}
{% load cmstags %}

{% ifequal menu_type "breadcrumb" %}
  {{ object|generate_breadcrumb:request }}
{% endifequal %}

{% ifequal menu_type "index" %}
<div class="page-resources">
<div id="block-menu_block-7" class="menu-block-7 menu-level-1">
{% for menu_item in menu.root_item.children %}
<ul class="menu">
  <li class="expanded"><a href="{{ menu_item.url|prepend_slash }}">{{ menu_item.caption }}</a>
  {% if menu_item.has_children %}
  <ul class="menu">
  {% for child_menu_item in menu_item.children %}
    {% if child_menu_item.extension.protected %}
    <li class="leaf"><a href="{{ child_menu_item.url|prepend_slash }}"><span>{{ child_menu_item.caption }}</span></a><img src="http://www.aashe.org/sites/all/themes/aashe10/images/icon-restricted-content.png" alt="Members-only Content"/></li>
    {% else %}
    <li class="leaf"><a href="{{ child_menu_item.url|prepend_slash }}"><span>{{ child_menu_item.caption }}</span></a></li>
    {% endif %}
  {% endfor %}
  </ul>
  {% endif %}
  </li>
</ul>
{% endfor %}
</div></div>
{% endifequal %}

{% ifequal menu_type "resource-menu" %}
  {% ifequal object.menuitem.level 2 %}
    {% if object.menuitem.has_children %}
    {% for child_menu_item in object.menuitem.children %}
      {% if child_menu_item.has_children %}
        <h2>{{ child_menu_item }}</h2>
        <ul class="menu">
        {% for child in child_menu_item.children %}
          {% if not child.has_children %}
            {% if child.extension.protected %}
              {% if child.url %}
              <li class="leaf"><a href="{{ child.url|prepend_slash }}"><span>{{ child.caption }}</span></a><img src="http://www.aashe.org/sites/all/themes/aashe10/images/icon-restricted-content.png" alt="Members-only Content"/></li>
              {% else %}
              <li class="leaf"><a href="{% url child.named_url %}"><span>{{ child.caption }}</span></a><img src="http://www.aashe.org/sites/all/themes/aashe10/images/icon-restricted-content.png" alt="Members-only Content"/></li>
              {% endif %}
            {% else %}
              {% if child.url %}
                <li class="leaf"><a href="{{ child.url|prepend_slash }}"><span>{{ child.caption }}</span></a></li>
              {% else %}
                 <li class="leaf"><a href="{% url child.named_url %}"><span>{{ child.caption }}</span></a></li>
              {% endif %}
            {% endif %}          
          {% else %}
            <li class="leaf"><span>{{ child }}</span></li>
            <ul class="menu">
            {% for second_child in child.children %}
              {% if second_child.extension.protected %}
                {% if second_child.url %}
                <li class="leaf"><a href="{{ second_child.url|prepend_slash }}"><span>{{ second_child.caption }}</span></a><img src="http://www.aashe.org/sites/all/themes/aashe10/images/icon-restricted-content.png" alt="Members-only Content"/></li>
                {% else %}
                <li class="leaf"><a href="/{% url second_child.named_url %}"><span>{{ second_child.caption }}</span></a><img src="http://www.aashe.org/sites/all/themes/aashe10/images/icon-restricted-content.png" alt="Members-only Content"/></li>
                {% endif %}
              {% else %}
                {% if second_child.url %}
                <li class="leaf"><a href="{{ second_child.url|prepend_slash }}"><span>{{ second_child.caption }}</span></a></li>
                {% else %}
                <li class="leaf"><a href="{% url second_child.named_url %}"><span>{{ second_child.caption }}</span></a></li>
                {% endif %}
              {% endif %}
            {% endfor %}
            </ul>
          {% endif %}
        {% endfor %}
        </ul>
      {% endif %}
    {% endfor %}
    {% endif %}
    {% if object.menuitem.has_children %}
    <ul class="menu">
    {% for child_menu_item in object.menuitem.children %}
      {% if not child_menu_item.has_children %}
        {% if child_menu_item.extension.protected %}
          {% if child_menu_item.url %}
          <li class="leaf"><a href="{{ child_menu_item.url|prepend_slash }}"><span>{{ child_menu_item }}</span></a><img src="http://www.aashe.org/sites/all/themes/aashe10/images/icon-restricted-content.png" alt="Members-only Content"/></li>
          {% else %}
          <li class="leaf"><a href="{% url child_menu_item.named_url %}"><span>{{ child_menu_item }}</span></a><img src="http://www.aashe.org/sites/all/themes/aashe10/images/icon-restricted-content.png" alt="Members-only Content"/></li>
          {% endif %}
        {% else %}
          {% if child_menu_item.url %}
          <li class="leaf"><a href="{{ child_menu_item.url|prepend_slash }}"><span>{{ child_menu_item }}</span></a></li>
          {% else %}
          <li class="leaf"><a href="{% url child_menu_item.named_url %}"><span>{{ child_menu_item }}</span></a></li>
          {% endif %}
        {% endif %}
      {% endif %}
    {% endfor %}
    </ul>
    {% endif %}
    {% else %}
    <ul class="menu">
    {% for child_menu_item in object.menuitem.children %}
      {% if child_menu_item.extension.protected %}
        {% if child_menu_item.url %}
        <li class="leaf"><a href="{{ child_menu_item.url|prepend_slash }}"><span>{{ child_menu_item }}</span></a><img src="http://www.aashe.org/sites/all/themes/aashe10/images/icon-restricted-content.png" alt="Members-only Content"/></li>
        {% else %}
        <li class="leaf"><a href="{% url child_menu_item.named_url %}"><span>{{ child_menu_item }}</span></a><img src="http://www.aashe.org/sites/all/themes/aashe10/images/icon-restricted-content.png" alt="Members-only Content"/></li>
        {% endif %}
      {% else %}
        {% if child_menu_item.url %}
        <li class="leaf"><a href="{{ child_menu_item.url|prepend_slash }}"><span>{{ child_menu_item }}</span></a></li>
        {% else %}        
        <li class="leaf"><a href="{% url child_menu_item.named_url %}"><span>{{ child_menu_item }}</span></a></li>
        {% endif %}
      {% endif %}
    {% endfor %}
    </ul>
  {% endifequal %}
{% endifequal %}

{% ifequal menu_type "sidebar" %}
<div class="block block-menu_block " id="block-menu_block-4">
  <h2 class="block-title"><none></none></h2>
  <div class="block-content content"><div class="menu-block-4 menu-name-menu-sitemap parent-mlid-38287 menu-level-1">
      <ul class="menu">
        {% for menu_item in menu.root_item.children %}
          {% if menu_item == object.menuitem %}
            <li class="expanded active-trail">
            <a href="{{ menu_item.url|prepend_slash }}" title="{{ menu_item.caption }}" class="active-trail"><span>{{ menu_item.caption }}</span></a>
              <ul class="menu">
              {% for child_menu_item in object.menuitem.children %}
                <li class="leaf"><a href="{{ child_menu_item.url|prepend_slash }}"><span>{{ child_menu_item }}</span></a></li>
              {% endfor %}
              </ul>
            <li>
          {% endif %}
          {% if menu_item == object.menuitem.parent %}
                <li class="expanded active-trail">
                <a href="{{ object.menuitem.parent.url|prepend_slash }}" title="{{ object.menuitem.parent.caption }}" class="active-trail"><span>{{ object.menuitem.parent.caption }}</span></a>
                  <ul class="menu">
                  {% for child_menu_item in object.menuitem.parent.children %}
                    {% if child_menu_item == object.menuitem %}
                    <li class="leaf"><a href="{{ child_menu_item.url|prepend_slash }}" class="active-trail"><span>{{ child_menu_item }}</span></a></li>
                    {% else %}
                    <li class="leaf"><a href="{{ child_menu_item.url|prepend_slash }}"><span>{{ child_menu_item }}</span></a></li>
                    {% endif %}
                  {% endfor %}
                  </ul>
                <li>
          {% endif %}
          {% if menu_item != object.menuitem and menu_item != object.menuitem.parent %}
            <li class="collapsed first">
            <a href="{{ menu_item.url|prepend_slash }}" title="{{ menu_item.caption }}"><span>{{ menu_item.caption}}</span></a>
            </li>
          {% endif %}
        {% endfor %}
    </ul></div>
  </div>
</div>
{% endifequal %}